(()=>{"use strict";var t=document.querySelector(".profile"),e=t.querySelector(".profile__avatar"),n=t.querySelector(".profile__user-name"),r=t.querySelector(".profile__user-description"),o=function(t,e,n,r){e.textContent=t?n:r},c=function(t){return t.ok?t.json():Promise.reject("Ошибка ".concat(t.status))},a="plus-cohort-21",i="e22a7236-eb1c-4145-a157-f86fa0ccbc4e",u="https://mesto.nomoreparties.co",l=document.querySelectorAll(".popup__close-button"),s=function(t){if("Escape"===t.key){var e=document.querySelector(".popup_opened");p(e)}},d=function(t){var e=document.querySelector(".popup_opened");t.target===e&&p(e)},f=function(t){p(t.target.closest(".popup"))},m=function(t){t.classList.add("popup_opened"),document.addEventListener("keydown",s),document.addEventListener("click",d)},p=function(t){t.classList.remove("popup_opened"),document.removeEventListener("keydown",s),document.removeEventListener("click",d)},v=document.querySelector(".popup_type_edit-user-data"),_=t.querySelector(".profile__edit-button"),y=document.forms.profile,h=v.querySelector("#user-name"),S=v.querySelector("#user-description"),b=y.querySelector(".form__submit"),q=t.querySelector(".profile__edit-avatar-button"),g=document.querySelector(".popup_type_edit-user-avatar"),E=document.forms["user-avatar"],k=E.querySelector("#user-avatar"),L=E.querySelector(".form__submit"),C=document.querySelector(".popup_type_image"),A=C.querySelector(".popup__image"),x=C.querySelector(".popup__image-title"),j=document.querySelector(".popup_type_remove"),T=j.querySelector(".popup__button");T.addEventListener("click",(function(){var t={};t._id=j.getAttribute("data-id");var e=document.querySelector(".card[data-id='".concat(t._id,"']"));o(!0,T,"Удаление...","Да"),function(t){return fetch("".concat(u,"/v1/").concat(a,"/cards/").concat(t._id),{method:"DELETE",headers:{authorization:i}}).then(c)}(t).then((function(){e.remove(),p(j)})).catch((function(t){console.log("Ошибка удаления карточки. Ошибка ".concat(t))})).finally((function(){o(!1,T,"Удаление...","Да")}))}));var w,O=document.querySelector("#card-template").content,z=function(t,e){t.textContent=0===e?"":e},D=function(e){var n=O.querySelector(".card").cloneNode(!0),r=n.querySelector(".card__image"),o=n.querySelector(".card__like-button"),l=n.querySelector(".card__like-value"),s=n.querySelector(".card__remove-button"),d=t.getAttribute("data-id");return n.querySelector(".card__title").textContent=e.name,n.setAttribute("data-id",e._id),r.src=e.link,r.alt="Фотография ".concat(e.name),z(l,e.likes.length),d!==e.owner._id&&s.remove(),function(t,e,n){0!==t.likes.length&&t.likes.forEach((function(t){Object.values(t).includes(e)&&n.classList.add("card__like-button_active")}))}(e,d,o),o.addEventListener("click",(function(t){!function(t,e,n){t.classList.contains("card__like-button_active")?function(t){return fetch("".concat(u,"/v1/").concat(a,"/cards/likes/").concat(t._id),{method:"DELETE",headers:{authorization:i}}).then(c)}(e).then((function(e){t.classList.toggle("card__like-button_active"),z(n,e.likes.length)})).catch((function(t){console.log("Ошибка удаления лайка у карточки. Ошибка ".concat(t))})):function(t){return fetch("".concat(u,"/v1/").concat(a,"/cards/likes/").concat(t._id),{method:"PUT",headers:{authorization:i}}).then(c)}(e).then((function(e){t.classList.toggle("card__like-button_active"),z(n,e.likes.length)})).catch((function(t){console.log("Ошибка добавления лайка карточке. Ошибка ".concat(t))}))}(t.target,e,l)})),s.addEventListener("click",(function(){m(j),j.setAttribute("data-id",e._id)})),r.addEventListener("click",(function(){!function(t){A.src=t.link,A.alt="Фотография ".concat(t.name),x.textContent=t.name,m(C)}(e)})),n},I=function(t,e){var n=D(t);e.prepend(n)},P=t.querySelector(".profile__add-button"),B=document.querySelector(".popup_type_add-new-card"),M=document.forms["add-new-card"],N=B.querySelector("#card-name"),J=B.querySelector("#card-image"),H=document.querySelector(".cards__list"),U=M.querySelector(".form__submit"),V=function(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(e)?(n.removeAttribute("disabled"),n.classList.remove(t.inactiveButtonClass)):(n.setAttribute("disabled",!0),n.classList.add(t.inactiveButtonClass))};function $(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}_.addEventListener("click",(function(){h.value=n.textContent,S.value=r.textContent,m(v)})),q.addEventListener("click",(function(){k.value=e.src,m(g)})),P.addEventListener("click",(function(){m(B)})),l.forEach((function(t){t.addEventListener("click",f)})),y.addEventListener("submit",(function(t){t.preventDefault(),o(!0,b,"Сохранение...","Сохранить");var e={};e.name=h.value,e.about=S.value,function(t){return fetch("".concat(u,"/v1/").concat(a,"/users/me"),{method:"PATCH",headers:{authorization:i,"Content-Type":"application/json"},body:JSON.stringify({name:t.name,about:t.about})}).then(c)}(e).then((function(){n.textContent=e.name,r.textContent=e.about,p(v)})).catch((function(t){console.log("Ошибка обновления информации о пользователе. Ошибка ".concat(t))})).finally((function(){o(!1,b,"Сохранение...","Сохранить")}))})),E.addEventListener("submit",(function(t){t.preventDefault(),o(!0,L,"Сохранение...","Сохранить");var n={};n.avatar=k.value,function(t){return fetch("".concat(u,"/v1/").concat(a,"/users/me/avatar"),{method:"PATCH",headers:{authorization:i,"Content-Type":"application/json"},body:JSON.stringify({avatar:t.avatar})}).then(c)}(n).then((function(){e.src=n.avatar,e.alt="Изображение аватара пользователя",p(g)})).catch((function(t){console.log("Ошибка обновления аватара пользователя. Ошибка ".concat(t))})).finally((function(){o(!1,L,"Сохранение...","Сохранить")}))})),M.addEventListener("submit",(function(t){var e;t.preventDefault(),o(!0,U,"Сохранение...","Создать"),(e={name:N.value,link:J.value},fetch("".concat(u,"/v1/").concat(a,"/cards"),{method:"POST",headers:{authorization:i,"Content-Type":"application/json"},body:JSON.stringify({name:e.name,link:e.link})}).then(c)).then((function(e){I(e,H),t.target.reset(),p(B)})).catch((function(t){console.log("Ошибка добавления информации о новой карточке. Ошибка ".concat(t))})).finally((function(){o(!1,U,"Сохранение...","Создать")}))})),w={formSelector:".form",fieldsetSelector:".form__set",inputSelector:".form__item",getErrorInputSelector:function(t){return".".concat(t,"-input-error")},submitButtonSelector:".form__submit",inactiveButtonClass:"form__submit_inactive",inputErrorClass:"form__item_type_error",errorClass:"form__item-error_active"},Array.from(document.querySelectorAll(w.formSelector)).forEach((function(t){t.addEventListener("submit",(function(t){t.preventDefault()})),Array.from(t.querySelectorAll(w.fieldsetSelector)).forEach((function(t){!function(t,e){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);V(t,n,r),e.parentElement.addEventListener("reset",(function(){V(t,n,r),setTimeout((function(){V(t,n,r)}),0)})),n.forEach((function(o){o.addEventListener("input",(function(){!function(t,e,n){n.validity.patternMismatch?n.setCustomValidity(n.dataset.errorMessage):n.setCustomValidity(""),n.validity.valid?function(t,e,n){var r=e.querySelector(t.getErrorInputSelector(n.id));n.classList.remove(t.inputErrorClass),r.classList.remove(t.errorClass),r.textContent=""}(t,e,n):function(t,e,n,r){var o=e.querySelector(t.getErrorInputSelector(n.id));n.classList.add(t.inputErrorClass),o.textContent=r,o.classList.add(t.errorClass)}(t,e,n,n.validationMessage)}(t,e,o),V(t,n,r)}))}))}(w,t)}))})),Promise.all([fetch("".concat(u,"/v1/").concat(a,"/users/me"),{headers:{authorization:i}}).then(c),fetch("".concat(u,"/v1/").concat(a,"/cards"),{headers:{authorization:i}}).then(c)]).then((function(o){var c,a,i=(a=2,function(t){if(Array.isArray(t))return t}(c=o)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,c,a,i=[],u=!0,l=!1;try{if(c=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=c.call(n)).done)&&(i.push(r.value),i.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw o}}return i}}(c,a)||function(t,e){if(t){if("string"==typeof t)return $(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?$(t,e):void 0}}(c,a)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),u=i[0],l=i[1];!function(t){e.src=t.avatar,n.textContent=t.name,r.textContent=t.about}(u),function(e){t.setAttribute("data-id",e._id)}(u),l.forEach((function(t){I(t,H)}))})).catch((function(t){console.log("Ошибка загрузки информации о пользователе/карточек. Ошибка ".concat(t))}))})();