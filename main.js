(()=>{"use strict";var t=document.querySelector(".profile"),e=t.querySelector(".profile__avatar"),n=t.querySelector(".profile__user-name"),o=t.querySelector(".profile__user-description"),r="plus-cohort-21",c="e22a7236-eb1c-4145-a157-f86fa0ccbc4e",a="https://mesto.nomoreparties.co",i=document.querySelectorAll(".popup__close-button"),u=function(t){if("Escape"===t.key){var e=document.querySelector(".popup_opened");f(e)}},s=function(t){var e=document.querySelector(".popup_opened");t.target===e&&f(e)},l=function(t){f(t.target.closest(".popup"))},d=function(t){t.classList.add("popup_opened"),document.addEventListener("keydown",u),document.addEventListener("click",s)},f=function(t){t.classList.remove("popup_opened"),document.removeEventListener("keydown",u),document.removeEventListener("click",s)},m=function(t,e,n){e.textContent=t?"Сохранение...":n},p=document.querySelector(".popup_type_edit-user-data"),v=t.querySelector(".profile__edit-button"),_=document.forms.profile,y=p.querySelector("#user-name"),h=p.querySelector("#user-description"),S=_.querySelector(".form__submit"),b=t.querySelector(".profile__edit-avatar-button"),q=document.querySelector(".popup_type_edit-user-avatar"),k=document.forms["user-avatar"],E=k.querySelector("#user-avatar"),g=k.querySelector(".form__submit"),L=document.querySelector(".popup_type_image"),C=L.querySelector(".popup__image"),j=L.querySelector(".popup__image-title"),A=document.querySelector(".popup_type_remove");A.querySelector(".popup__button").addEventListener("click",(function(){var t={};t._id=A.getAttribute("data-id");var e=document.querySelector(".card[data-id='".concat(t._id,"']"));!function(t){fetch("".concat(a,"/v1/").concat(r,"/cards/").concat(t._id),{method:"DELETE",headers:{authorization:c}}).then((function(t){return t.ok?t.json():Promise.reject(t.status)})).catch((function(t){console.log("Ошибка удаления карточки. Ошибка ".concat(t))}))}(t),e.remove(),f(A)}));var x,P=document.querySelector("#card-template").content,T=function(t,e){t.textContent=0===e?"":e},z=function(e){var n=P.querySelector(".card").cloneNode(!0),o=n.querySelector(".card__image"),i=n.querySelector(".card__like-button"),u=n.querySelector(".card__like-value"),s=n.querySelector(".card__remove-button"),l=t.getAttribute("data-id");return n.querySelector(".card__title").textContent=e.name,n.setAttribute("data-id",e._id),o.src=e.link,o.alt="Фотография ".concat(e.name),T(u,e.likes.length),l!==e.owner._id&&s.remove(),function(t,e,n){0!==t.likes.length&&t.likes.forEach((function(t){Object.values(t).includes(e)&&n.classList.add("card__like-button_active")}))}(e,l,i),i.addEventListener("click",(function(t){(function(t,e,n){t.classList.contains("card__like-button_active")?function(t){return fetch("".concat(a,"/v1/").concat(r,"/cards/likes/").concat(t._id),{method:"DELETE",headers:{authorization:c}}).then((function(t){return t.ok?t.json():Promise.reject(t.status)})).catch((function(t){console.log("Ошибка удаления лайка у карточки. Ошибка ".concat(t))}))}(e).then((function(t){T(n,t.likes.length)})):function(t){return fetch("".concat(a,"/v1/").concat(r,"/cards/likes/").concat(t._id),{method:"PUT",headers:{authorization:c}}).then((function(t){return t.ok?t.json():Promise.reject(t.status)})).catch((function(t){console.log("Ошибка добавления лайка карточке. Ошибка ".concat(t))}))}(e).then((function(t){T(n,t.likes.length)}))})(t.target,e,u),t.target.classList.toggle("card__like-button_active")})),s.addEventListener("click",(function(){d(A),A.setAttribute("data-id",e._id)})),o.addEventListener("click",(function(){!function(t){C.src=t.link,C.alt="Фотография ".concat(t.name),j.textContent=t.name,d(L)}(e)})),n},D=function(t,e){var n=z(t);e.prepend(n)},w=t.querySelector(".profile__add-button"),B=document.querySelector(".popup_type_add-new-card"),O=document.forms["add-new-card"],N=B.querySelector("#card-name"),I=B.querySelector("#card-image"),J=document.querySelector(".cards__list"),M=O.querySelector(".form__submit"),H=function(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(e)?(n.removeAttribute("disabled"),n.classList.remove(t.inactiveButtonClass)):(n.setAttribute("disabled",!0),n.classList.add(t.inactiveButtonClass))};v.addEventListener("click",(function(){y.value=n.textContent,h.value=o.textContent,d(p)})),b.addEventListener("click",(function(){E.value=e.src,d(q)})),w.addEventListener("click",(function(){d(B)})),i.forEach((function(t){t.addEventListener("click",l)})),_.addEventListener("submit",(function(t){t.preventDefault(),m(!0,S,"Сохранить");var e={};e.name=y.value,e.about=h.value,n.textContent=e.name,o.textContent=e.about,function(t){return fetch("".concat(a,"/v1/").concat(r,"/users/me"),{method:"PATCH",headers:{authorization:c,"Content-Type":"application/json"},body:JSON.stringify({name:t.name,about:t.about})}).then((function(t){return t.ok?t.json():Promise.reject(t.status)})).catch((function(t){console.log("Ошибка обновления информации о пользователе. Ошибка ".concat(t))}))}(e).finally((function(){m(!1,S,"Сохранить")})),f(p)})),k.addEventListener("submit",(function(t){t.preventDefault(),m(!0,g,"Сохранить");var n={};n.avatar=E.value,e.src=n.avatar,e.alt="Изображение аватара пользователя",function(t){return fetch("".concat(a,"/v1/").concat(r,"/users/me/avatar"),{method:"PATCH",headers:{authorization:c,"Content-Type":"application/json"},body:JSON.stringify({avatar:t.avatar})}).then((function(t){return t.ok?t.json():Promise.reject(t.status)})).catch((function(t){console.log("Ошибка обновления аватара пользователя. Ошибка ".concat(t))}))}(n).finally((function(){m(!1,g,"Сохранить")})),f(q)})),O.addEventListener("submit",(function(t){var e;t.preventDefault(),m(!0,M,"Создать"),(e={name:N.value,link:I.value},fetch("".concat(a,"/v1/").concat(r,"/cards"),{method:"POST",headers:{authorization:c,"Content-Type":"application/json"},body:JSON.stringify({name:e.name,link:e.link})}).then((function(t){return t.ok?t.json():Promise.reject(t.status)})).catch((function(t){console.log("Ошибка добавления информации о новой карточке. Ошибка ".concat(t))}))).then((function(t){D(t,J)})).finally((function(){m(!1,M,"Создать"),t.target.reset(),f(B)}))})),x={formSelector:".form",fieldsetSelector:".form__set",inputSelector:".form__item",getErrorInputSelector:function(t){return".".concat(t,"-input-error")},submitButtonSelector:".form__submit",inactiveButtonClass:"form__submit_inactive",inputErrorClass:"form__item_type_error",errorClass:"form__item-error_active"},Array.from(document.querySelectorAll(x.formSelector)).forEach((function(t){t.addEventListener("submit",(function(t){t.preventDefault()})),Array.from(t.querySelectorAll(x.fieldsetSelector)).forEach((function(t){!function(t,e){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);H(t,n,o),e.parentElement.addEventListener("reset",(function(){H(t,n,o),setTimeout((function(){H(t,n,o)}),0)})),n.forEach((function(r){r.addEventListener("input",(function(){!function(t,e,n){n.validity.patternMismatch?n.setCustomValidity(n.dataset.errorMessage):n.setCustomValidity(""),n.validity.valid?function(t,e,n){var o=e.querySelector(t.getErrorInputSelector(n.id));n.classList.remove(t.inputErrorClass),o.classList.remove(t.errorClass),o.textContent=""}(t,e,n):function(t,e,n,o){var r=e.querySelector(t.getErrorInputSelector(n.id));n.classList.add(t.inputErrorClass),r.textContent=o,r.classList.add(t.errorClass)}(t,e,n,n.validationMessage)}(t,e,r),H(t,n,o)}))}))}(x,t)}))})),fetch("".concat(a,"/v1/").concat(r,"/users/me"),{headers:{authorization:c}}).then((function(t){return t.ok?t.json():Promise.reject(t.status)})).catch((function(t){console.log("Ошибка загрузки информации о пользователе. Ошибка ".concat(t))})).then((function(r){var c;c=r,e.src=c.avatar,n.textContent=c.name,o.textContent=c.about,function(e){t.setAttribute("data-id",e._id)}(r)})),fetch("".concat(a,"/v1/").concat(r,"/cards"),{headers:{authorization:c}}).then((function(t){return t.ok?t.json():Promise.reject(t.status)})).catch((function(t){console.log("Ошибка загрузки карточек. Ошибка ".concat(t))})).then((function(t){t.forEach((function(t){D(t,J)}))}))})();